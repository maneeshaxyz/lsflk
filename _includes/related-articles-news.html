<section class="py-10 bg-white">
  <div class="max-w-screen-xl mx-auto px-4">
    <h2 class="text-2xl sm:text-3xl font-bold mb-6 text-center">All Blogs</h2>

    <div class="relative overflow-hidden">
      <div id="carouselTrack" class="flex transition-transform duration-500 ease-in-out" style="transform: translateX(0%);">
        
        {% for post in site.posts limit:6 %}
        <div class="px-2 box-border flex-shrink-0 w-full sm:w-1/2 lg:w-1/3">
          <a href="{{ post.url | relative_url }}" class="block">
            <img src="{{ post.image | default: 'images/home/artical_default.webp' | relative_url }}" alt="{{ post.title }}" class="rounded w-full aspect-square object-cover">
            <div class="text-left mt-2">
              <small class="block text-sm text-gray-500">{{ post.category }}</small>
              <h6 class="font-semibold text-base">{{ post.title }}</h6>
            </div>
          </a>
        </div>
        {% endfor %}
      </div>

      <button id="prevBtn" class="absolute top-1/2 -translate-y-1/2 left-4 z-10 transition-opacity hover:opacity-75">
        <svg class="w-8 h-8 text-white drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M12.707 14.707a1 1 0 01-1.414 0L7.586 11l3.707-3.707a1 1 0 011.414 1.414L10.414 11l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd"/></svg>
      </button>
      <button id="nextBtn" class="absolute top-1/2 -translate-y-1/2 right-4 z-10 transition-opacity hover:opacity-75">
        <svg class="w-8 h-8 text-white drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L9.586 11 7.293 8.707a1 1 0 011.414-1.414L12.414 11l-3.707 3.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/></svg>
      </button>
    </div>
  </div>
</section>

<script>
  const track = document.getElementById('carouselTrack');
  const nextBtn = document.getElementById('nextBtn');
  const prevBtn = document.getElementById('prevBtn');
  
  // Make sure script doesn't break if there are no posts
  if (track && track.children.length > 0) {
    const items = track.children;
    let currentIndex = 0;
    let autoScrollInterval;

    function getVisibleItems() {
      if (window.innerWidth >= 1024) return 3; // Desktop
      if (window.innerWidth >= 640) return 2;  // Tablet
      return 1;                                // Mobile
    }

    function updateSlider(smooth = true) {
      const visibleItems = getVisibleItems();
      const maxIndex = items.length - visibleItems;
      
      if (currentIndex > maxIndex) currentIndex = maxIndex;
      if (currentIndex < 0) currentIndex = 0;
      
      const itemWidth = 100 / visibleItems;
      const newTransform = -itemWidth * currentIndex;
      
      track.style.transition = smooth ? 'transform 0.5s ease-in-out' : 'none';
      track.style.transform = `translateX(${newTransform}%)`;
    }

    function moveToNext() {
      const visibleItems = getVisibleItems();
      const maxIndex = items.length - visibleItems;
      if (maxIndex < 0) return; // Not enough items to scroll
      
      currentIndex = (currentIndex + 1) > maxIndex ? 0 : currentIndex + 1;
      updateSlider();
    }
    
    function startAutoScroll() {
        stopAutoScroll(); // Prevent multiple intervals
        autoScrollInterval = setInterval(moveToNext, 4000);
    }
    
    function stopAutoScroll() {
        clearInterval(autoScrollInterval);
    }

    nextBtn.addEventListener("click", () => {
      moveToNext();
      stopAutoScroll();
    });

    prevBtn.addEventListener("click", () => {
      const visibleItems = getVisibleItems();
      const maxIndex = items.length - visibleItems;
      if (maxIndex < 0) return;

      currentIndex = (currentIndex - 1) < 0 ? maxIndex : currentIndex - 1;
      updateSlider();
      stopAutoScroll();
    });
    
    window.addEventListener("resize", () => updateSlider(false));

    // Start the auto-scrolling
    startAutoScroll();
  }
</script>